# 2.1.4 –í—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

## –°—Ç–∞—Ç—É—Å: üîÑ –í —Ä–∞–±–æ—Ç–µ
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: voleum

---

## –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Ö—Ä–∞–Ω–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö

### üìä –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∏–≥—Ä–µ –°—É–¥–æ–∫—É

**–ù–∞ –æ—Å–Ω–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–ø. 1.4) –≤—ã–¥–µ–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–ª–æ–∂–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞** - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –ø—Ä–æ—Å—Ç—ã–µ key-value –ø–∞—Ä—ã
4. **–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤** - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω—ã
5. **–ö—ç—à –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –¥–∞–Ω–Ω—ã–º

### üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ—à–µ–Ω–∏–π

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –°–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
- –†–∞–∑–º–µ—Ä –∑–∞–Ω–∏–º–∞–µ–º–æ–π –ø–∞–º—è—Ç–∏
- –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö (–¥–æ 10000+ –∏–≥—Ä)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –°—Ö–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React Native
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–ª–∞–¥–∫–∏

---

## 1. –û–±–∑–æ—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π

### 1.1 SQLite

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –°–£–ë–î
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `react-native-sqlite-storage`

‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ó—Ä–µ–ª–æ–µ –∏ –Ω–∞–¥–µ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- SQL –∑–∞–ø—Ä–æ—Å—ã –∏ —Å–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏
- –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ iOS/Android
- –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –¢—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è SQL
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ UI thread (–µ—Å–ª–∏ –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

**–†–∞–∑–º–µ—Ä**: ~1-2 MB –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ APK/IPA

### 1.2 Realm

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—ä–µ–∫—Ç–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `realm`

‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Lazy loading
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä (8-15 MB –∫ APK)
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å debugging
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- Potential vendor lock-in

**–†–∞–∑–º–µ—Ä**: ~8-15 MB –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ APK/IPA

### 1.3 AsyncStorage

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ—Å—Ç–æ–µ key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `@react-native-async-storage/async-storage`

‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–æ–µ API
- –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ù–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–æ–∫ –∏ JSON

‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢–æ–ª—å–∫–æ key-value
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–∞–∑–º–µ—Ä**: ~100 KB

### 1.4 MMKV

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `react-native-mmkv`

‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä
- –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å

‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢–æ–ª—å–∫–æ key-value
- –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–†–∞–∑–º–µ—Ä**: ~200 KB

### 1.5 WatermelonDB

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–∞–∫—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è React Native
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `@nozbe/watermelondb`

‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è React Native
- Lazy loading
- –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–∞—è
- –ë–æ–ª—å—à–∏–π learning curve
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ SQLite

**–†–∞–∑–º–µ—Ä**: ~2-3 MB

---

## 2. –í—ã–±–æ—Ä —Ä–µ—à–µ–Ω–∏–π –ø–æ —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí SQLite

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
- –°–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∏–≥—Ä–∞–º–∏, —Ö–æ–¥–∞–º–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

**–î–∞–Ω–Ω—ã–µ:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤ –∏–≥—Ä
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 2.2 –ü—Ä–æ—Å—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí AsyncStorage

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
- –ü—Ä–æ—Å—Ç—ã–µ key-value –ø–∞—Ä—ã
- –ù–µ—á–∞—Å—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zustand persist
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–î–∞–Ω–Ω—ã–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –Ø–∑—ã–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2.3 –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫—ç—à ‚Üí MMKV

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
- –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø
- –ß–∞—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API
- –ú–∞–ª–µ–Ω—å–∫–∏–π overhead

**–î–∞–Ω–Ω—ã–µ:**
- –ö—ç—à —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ UI
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## 3. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLite)

### 3.1 –¢–∞–±–ª–∏—Ü–∞ games (–ò–≥—Ä—ã)

```sql
CREATE TABLE games (
    id                INTEGER PRIMARY KEY AUTOINCREMENT,
    uuid              TEXT UNIQUE NOT NULL,           -- UUID –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    name              TEXT,                           -- –ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    difficulty        TEXT NOT NULL,                  -- 'easy', 'medium', 'hard', 'expert'

    -- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    original_grid     TEXT NOT NULL,                  -- JSON –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–∞–∑–ª–∞
    current_grid      TEXT NOT NULL,                  -- JSON —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    completed_grid    TEXT,                           -- JSON —Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ)

    -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    created_at        INTEGER NOT NULL,               -- Unix timestamp —Å–æ–∑–¥–∞–Ω–∏—è
    updated_at        INTEGER NOT NULL,               -- Unix timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    started_at        INTEGER,                        -- Unix timestamp –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
    completed_at      INTEGER,                        -- Unix timestamp –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

    -- –ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    play_time         INTEGER DEFAULT 0,              -- –í—Ä–µ–º—è –∏–≥—Ä—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    paused_time       INTEGER DEFAULT 0,              -- –í—Ä–µ–º—è –Ω–∞ –ø–∞—É–∑–µ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    moves_count       INTEGER DEFAULT 0,              -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö–æ–¥–æ–≤
    hints_used        INTEGER DEFAULT 0,              -- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    errors_count      INTEGER DEFAULT 0,              -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

    -- –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
    is_completed      INTEGER DEFAULT 0,              -- –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ –∏–≥—Ä–∞ (0/1)
    is_paused         INTEGER DEFAULT 0,              -- –ù–∞ –ø–∞—É–∑–µ –ª–∏ –∏–≥—Ä–∞ (0/1)

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    version          INTEGER DEFAULT 1,               -- –í–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

    -- –ò–Ω–¥–µ–∫—Å—ã
    FOREIGN KEY (difficulty) REFERENCES difficulty_levels(name)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_games_difficulty ON games(difficulty);
CREATE INDEX idx_games_completed ON games(is_completed);
CREATE INDEX idx_games_created_at ON games(created_at);
CREATE INDEX idx_games_uuid ON games(uuid);
```

### 3.2 –¢–∞–±–ª–∏—Ü–∞ game_moves (–ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤)

```sql
CREATE TABLE game_moves (
    id              INTEGER PRIMARY KEY AUTOINCREMENT,
    game_id         INTEGER NOT NULL,

    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö–æ–¥–µ
    move_number     INTEGER NOT NULL,                 -- –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ö–æ–¥–∞
    row_index       INTEGER NOT NULL,                 -- –°—Ç—Ä–æ–∫–∞ (0-8)
    col_index       INTEGER NOT NULL,                 -- –°—Ç–æ–ª–±–µ—Ü (0-8)
    previous_value  INTEGER,                          -- –ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0-9, 0=–ø—É—Å—Ç–æ)
    new_value       INTEGER NOT NULL,                 -- –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0-9, 0=—Å—Ç–µ—Ä–µ—Ç—å)

    -- –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
    timestamp       INTEGER NOT NULL,                 -- Unix timestamp —Ö–æ–¥–∞

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö–æ–¥–∞
    is_hint         INTEGER DEFAULT 0,                -- –•–æ–¥ –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–µ (0/1)
    is_error        INTEGER DEFAULT 0,                -- –û—à–∏–±–æ—á–Ω—ã–π —Ö–æ–¥ (0/1)

    FOREIGN KEY (game_id) REFERENCES games(id) ON DELETE CASCADE
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_moves_game_id ON game_moves(game_id);
CREATE INDEX idx_moves_game_move_number ON game_moves(game_id, move_number);
```

### 3.3 –¢–∞–±–ª–∏—Ü–∞ statistics (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞)

```sql
CREATE TABLE statistics (
    id                    INTEGER PRIMARY KEY AUTOINCREMENT,
    difficulty            TEXT NOT NULL,

    -- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    games_played          INTEGER DEFAULT 0,
    games_completed       INTEGER DEFAULT 0,
    games_abandoned       INTEGER DEFAULT 0,

    -- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    total_play_time       INTEGER DEFAULT 0,         -- –û–±—â–µ–µ –≤—Ä–µ–º—è –∏–≥—Ä—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    average_time          INTEGER DEFAULT 0,         -- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    best_time             INTEGER DEFAULT 0,         -- –õ—É—á—à–µ–µ –≤—Ä–µ–º—è
    worst_time            INTEGER DEFAULT 0,         -- –•—É–¥—à–µ–µ –≤—Ä–µ–º—è

    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö–æ–¥–æ–≤
    total_moves           INTEGER DEFAULT 0,
    average_moves         INTEGER DEFAULT 0,
    best_moves            INTEGER DEFAULT 0,

    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –æ—à–∏–±–æ–∫
    total_hints           INTEGER DEFAULT 0,
    average_hints         INTEGER DEFAULT 0,
    total_errors          INTEGER DEFAULT 0,
    average_errors        INTEGER DEFAULT 0,

    -- –°–µ—Ä–∏–∏
    current_streak        INTEGER DEFAULT 0,         -- –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è –ø–æ–±–µ–¥
    longest_streak        INTEGER DEFAULT 0,         -- –°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Å–µ—Ä–∏—è
    current_daily_streak  INTEGER DEFAULT 0,         -- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–µ—Ä–∏—è
    longest_daily_streak  INTEGER DEFAULT 0,

    -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    last_played           INTEGER,                    -- –ü–æ—Å–ª–µ–¥–Ω—è—è –∏–≥—Ä–∞
    last_completed        INTEGER,                    -- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    updated_at            INTEGER NOT NULL,

    UNIQUE(difficulty)
);

-- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
INSERT INTO statistics (difficulty, updated_at) VALUES
    ('easy', strftime('%s', 'now')),
    ('medium', strftime('%s', 'now')),
    ('hard', strftime('%s', 'now')),
    ('expert', strftime('%s', 'now'));
```

### 3.4 –¢–∞–±–ª–∏—Ü–∞ achievements (–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è)

```sql
CREATE TABLE achievements (
    id              INTEGER PRIMARY KEY AUTOINCREMENT,
    key             TEXT UNIQUE NOT NULL,             -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    name            TEXT NOT NULL,                    -- –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    description     TEXT NOT NULL,                    -- –û–ø–∏—Å–∞–Ω–∏–µ
    category        TEXT NOT NULL,                    -- –ö–∞—Ç–µ–≥–æ—Ä–∏—è ('time', 'streak', 'count', etc.)

    -- –£—Å–ª–æ–≤–∏—è
    target_value    INTEGER,                          -- –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    target_difficulty TEXT,                           -- –°–ª–æ–∂–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ)

    -- –°—Ç–∞—Ç—É—Å
    is_unlocked     INTEGER DEFAULT 0,               -- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ (0/1)
    unlocked_at     INTEGER,                          -- –í—Ä–µ–º—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    progress        INTEGER DEFAULT 0,               -- –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    icon            TEXT,                             -- –ù–∞–∑–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
    points          INTEGER DEFAULT 0,               -- –û—á–∫–∏ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
    is_hidden       INTEGER DEFAULT 0,               -- –°–∫—Ä—ã—Ç–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ

    created_at      INTEGER NOT NULL
);

-- –ü—Ä–∏–º–µ—Ä –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
INSERT INTO achievements (key, name, description, category, target_value, is_unlocked, created_at) VALUES
    ('first_win', '–ü–µ—Ä–≤–∞—è –ø–æ–±–µ–¥–∞', '–ó–∞–≤–µ—Ä—à–∏—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∏–≥—Ä—É', 'milestone', 1, 0, strftime('%s', 'now')),
    ('speed_demon', '–°–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –¥–µ–º–æ–Ω', '–ó–∞–≤–µ—Ä—à–∏—Ç–µ –ª–µ–≥–∫—É—é –∏–≥—Ä—É –∑–∞ 3 –º–∏–Ω—É—Ç—ã', 'time', 180, 0, strftime('%s', 'now')),
    ('perfectionist', '–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç', '–ó–∞–≤–µ—Ä—à–∏—Ç–µ –∏–≥—Ä—É –±–µ–∑ –æ—à–∏–±–æ–∫', 'accuracy', 0, 0, strftime('%s', 'now')),
    ('streak_5', '–ù–∞ –≤–æ–ª–Ω–µ', '–í—ã–∏–≥—Ä–∞–π—Ç–µ 5 –∏–≥—Ä –ø–æ–¥—Ä—è–¥', 'streak', 5, 0, strftime('%s', 'now')),
    ('daily_player', '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∏–≥—Ä–æ–∫', '–ò–≥—Ä–∞–π—Ç–µ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥', 'habit', 7, 0, strftime('%s', 'now'));
```

### 3.5 –¢–∞–±–ª–∏—Ü–∞ settings_backup (–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫)

```sql
CREATE TABLE settings_backup (
    id              INTEGER PRIMARY KEY AUTOINCREMENT,
    settings_json   TEXT NOT NULL,                   -- JSON –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
    version         TEXT NOT NULL,                   -- –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    created_at      INTEGER NOT NULL,

    -- –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
    CONSTRAINT max_backups CHECK (id <= (SELECT MAX(id) FROM settings_backup) + 1)
);
```

---

## 4. –°—Ö–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ AsyncStorage

### 4.1 –ö–ª—é—á–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

```typescript
const STORAGE_KEYS = {
  // –ò–≥—Ä–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  GAME_SETTINGS: 'sudoku:game_settings',
  UI_SETTINGS: 'sudoku:ui_settings',
  SOUND_SETTINGS: 'sudoku:sound_settings',

  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
  USER_PREFERENCES: 'sudoku:user_preferences',
  LANGUAGE: 'sudoku:language',
  THEME: 'sudoku:theme',

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  APP_VERSION: 'sudoku:app_version',
  LAST_LAUNCH: 'sudoku:last_launch',
  TUTORIAL_COMPLETED: 'sudoku:tutorial_completed',

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  ANALYTICS_CONSENT: 'sudoku:analytics_consent',
  CRASH_REPORTS_CONSENT: 'sudoku:crash_reports_consent'
} as const;
```

### 4.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```typescript
interface GameSettings {
  defaultDifficulty: DifficultyLevel;
  hintsEnabled: boolean;
  hintsLimit: number;
  errorHighlighting: boolean;
  autoCheckMistakes: boolean;
  showPossibleValues: boolean;
  highlightSameNumbers: boolean;
  autoMarkNotes: boolean;
}

interface UISettings {
  theme: 'light' | 'dark' | 'auto';
  colorScheme: 'classic' | 'modern' | 'colorful';
  showTimer: boolean;
  showMoveCounter: boolean;
  showErrorCounter: boolean;
  showHintCounter: boolean;
  cellSize: 'small' | 'medium' | 'large';
  fontSize: 'small' | 'medium' | 'large';
  animationsEnabled: boolean;
  animationSpeed: 'slow' | 'normal' | 'fast';
  vibrationEnabled: boolean;
}

interface SoundSettings {
  soundEnabled: boolean;
  soundVolume: number;
  cellPlacementSound: boolean;
  errorSound: boolean;
  successSound: boolean;
  hintSound: boolean;
  completionSound: boolean;
}
```

---

## 5. –°—Ö–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ MMKV

### 5.1 –ö–ª—é—á–∏ –¥–ª—è –∫—ç—à–∞

```typescript
const CACHE_KEYS = {
  // –¢–µ–∫—É—â–∞—è –∏–≥—Ä–∞
  CURRENT_GAME: 'current_game',
  SELECTED_CELL: 'selected_cell',
  GAME_TIMER: 'game_timer',

  // UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  LAST_SCREEN: 'last_screen',
  SCROLL_POSITIONS: 'scroll_positions',
  EXPANDED_SECTIONS: 'expanded_sections',

  // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  PENDING_MOVES: 'pending_moves',
  DRAFT_NOTES: 'draft_notes',

  // –ö—ç—à –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
  PUZZLE_HINTS: 'puzzle_hints_',  // + puzzle_id
  POSSIBLE_VALUES: 'possible_values_', // + cell_position

  // –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  GENERATION_CACHE: 'generation_cache_', // + difficulty
  SOLVE_CACHE: 'solve_cache_' // + puzzle_hash
} as const;
```

### 5.2 –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
interface CacheItem<T> {
  data: T;
  timestamp: number;
  ttl?: number; // Time to live –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
}

class GameCache {
  // –ö—ç—à —Å TTL
  static set<T>(key: string, data: T, ttl?: number): void {
    const item: CacheItem<T> = {
      data,
      timestamp: Date.now(),
      ttl
    };
    storage.set(key, JSON.stringify(item));
  }

  static get<T>(key: string): T | null {
    const item = storage.getString(key);
    if (!item) return null;

    const cached: CacheItem<T> = JSON.parse(item);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL
    if (cached.ttl && Date.now() - cached.timestamp > cached.ttl * 1000) {
      storage.delete(key);
      return null;
    }

    return cached.data;
  }
}
```

---

## 6. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### 6.1 –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```typescript
const DB_VERSION = 1;
const DB_NAME = 'sudoku.db';

interface MigrationScript {
  version: number;
  up: string[];    // SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
  down: string[];  // SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
}

const migrations: MigrationScript[] = [
  {
    version: 1,
    up: [
      `CREATE TABLE games (...)`,
      `CREATE TABLE game_moves (...)`,
      `CREATE TABLE statistics (...)`,
      `CREATE TABLE achievements (...)`
    ],
    down: [
      'DROP TABLE achievements',
      'DROP TABLE statistics',
      'DROP TABLE game_moves',
      'DROP TABLE games'
    ]
  },
  // –ë—É–¥—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏...
];
```

### 6.2 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```typescript
class DatabaseMigrator {
  static async migrate(db: SQLiteDatabase): Promise<void> {
    const currentVersion = await this.getCurrentVersion(db);

    for (const migration of migrations) {
      if (migration.version > currentVersion) {
        console.log(`Applying migration ${migration.version}`);

        await db.transaction(async (tx) => {
          for (const sql of migration.up) {
            await tx.executeSql(sql);
          }
          await this.setVersion(tx, migration.version);
        });
      }
    }
  }

  static async getCurrentVersion(db: SQLiteDatabase): Promise<number> {
    try {
      const result = await db.executeSql('PRAGMA user_version');
      return result[0].rows.item(0)['user_version'];
    } catch {
      return 0;
    }
  }

  static async setVersion(tx: SQLiteTransaction, version: number): Promise<void> {
    await tx.executeSql(`PRAGMA user_version = ${version}`);
  }
}
```

### 6.3 –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```typescript
class DataBackup {
  static async createBackup(): Promise<string> {
    const backupData = {
      version: DB_VERSION,
      timestamp: Date.now(),
      games: await this.exportGames(),
      statistics: await this.exportStatistics(),
      achievements: await this.exportAchievements(),
      settings: await this.exportSettings()
    };

    const backupJson = JSON.stringify(backupData);
    const backupPath = `${RNFS.DocumentDirectoryPath}/backup_${Date.now()}.json`;

    await RNFS.writeFile(backupPath, backupJson, 'utf8');
    return backupPath;
  }

  static async restoreBackup(backupPath: string): Promise<void> {
    const backupJson = await RNFS.readFile(backupPath, 'utf8');
    const backupData = JSON.parse(backupJson);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π
    if (backupData.version > DB_VERSION) {
      throw new Error('Backup from newer version is not supported');
    }

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    await this.importGames(backupData.games);
    await this.importStatistics(backupData.statistics);
    await this.importAchievements(backupData.achievements);
    await this.importSettings(backupData.settings);
  }
}
```

---

## 7. API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

### 7.1 Repository Pattern

```typescript
interface IGameRepository {
  // CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
  save(game: GameEntity): Promise<string>;
  findById(id: string): Promise<GameEntity | null>;
  findAll(): Promise<GameEntity[]>;
  delete(id: string): Promise<void>;

  // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  findByDifficulty(difficulty: DifficultyLevel): Promise<GameEntity[]>;
  findActive(): Promise<GameEntity[]>;
  findCompleted(limit?: number): Promise<GameEntity[]>;

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  getCompletionStats(): Promise<CompletionStats>;
  getTotalPlayTime(): Promise<number>;
}

class SQLiteGameRepository implements IGameRepository {
  constructor(private db: SQLiteDatabase) {}

  async save(game: GameEntity): Promise<string> {
    const sql = `
      INSERT OR REPLACE INTO games
      (uuid, name, difficulty, original_grid, current_grid, created_at, updated_at,
       play_time, hints_used, errors_count, is_completed)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `;

    const result = await this.db.executeSql(sql, [
      game.uuid,
      game.name,
      game.difficulty,
      JSON.stringify(game.originalGrid),
      JSON.stringify(game.currentGrid),
      game.createdAt.getTime(),
      Date.now(),
      game.playTime,
      game.hintsUsed,
      game.errorsCount,
      game.isCompleted ? 1 : 0
    ]);

    return game.uuid;
  }

  async findById(uuid: string): Promise<GameEntity | null> {
    const sql = 'SELECT * FROM games WHERE uuid = ?';
    const result = await this.db.executeSql(sql, [uuid]);

    if (result[0].rows.length === 0) return null;

    const row = result[0].rows.item(0);
    return this.mapRowToEntity(row);
  }

  private mapRowToEntity(row: any): GameEntity {
    return new GameEntity({
      uuid: row.uuid,
      name: row.name,
      difficulty: row.difficulty as DifficultyLevel,
      originalGrid: JSON.parse(row.original_grid),
      currentGrid: JSON.parse(row.current_grid),
      createdAt: new Date(row.created_at),
      updatedAt: new Date(row.updated_at),
      playTime: row.play_time,
      hintsUsed: row.hints_used,
      errorsCount: row.errors_count,
      isCompleted: row.is_completed === 1
    });
  }
}
```

### 7.2 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Repository

```typescript
interface IStatisticsRepository {
  getByDifficulty(difficulty: DifficultyLevel): Promise<StatisticsEntity>;
  updateAfterGame(difficulty: DifficultyLevel, gameResult: GameResult): Promise<void>;
  getOverallStats(): Promise<OverallStats>;
  resetStats(difficulty?: DifficultyLevel): Promise<void>;
}

class SQLiteStatisticsRepository implements IStatisticsRepository {
  async updateAfterGame(difficulty: DifficultyLevel, result: GameResult): Promise<void> {
    const sql = `
      UPDATE statistics
      SET
        games_played = games_played + 1,
        games_completed = games_completed + ?,
        total_play_time = total_play_time + ?,
        total_moves = total_moves + ?,
        total_hints = total_hints + ?,
        total_errors = total_errors + ?,
        current_streak = CASE
          WHEN ? = 1 THEN current_streak + 1
          ELSE 0
        END,
        longest_streak = MAX(longest_streak,
          CASE WHEN ? = 1 THEN current_streak + 1 ELSE 0 END),
        best_time = CASE
          WHEN best_time = 0 OR (? > 0 AND ? < best_time) THEN ?
          ELSE best_time
        END,
        last_played = ?,
        last_completed = CASE WHEN ? = 1 THEN ? ELSE last_completed END,
        updated_at = ?
      WHERE difficulty = ?
    `;

    const completed = result.isCompleted ? 1 : 0;
    const timestamp = Date.now();

    await this.db.executeSql(sql, [
      completed,
      result.playTime,
      result.movesCount,
      result.hintsUsed,
      result.errorsCount,
      completed,
      completed,
      result.playTime,
      result.playTime,
      result.playTime,
      timestamp,
      completed,
      timestamp,
      timestamp,
      difficulty
    ]);
  }
}
```

### 7.3 –°–ª–æ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
class CachedGameRepository implements IGameRepository {
  constructor(
    private repository: IGameRepository,
    private cache: GameCache
  ) {}

  async findById(id: string): Promise<GameEntity | null> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    const cached = this.cache.get<GameEntity>(`game:${id}`);
    if (cached) return cached;

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –±–∞–∑—ã
    const game = await this.repository.findById(id);
    if (game) {
      // –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 5 –º–∏–Ω—É—Ç
      this.cache.set(`game:${id}`, game, 300);
    }

    return game;
  }

  async save(game: GameEntity): Promise<string> {
    const result = await this.repository.save(game);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
    this.cache.set(`game:${game.uuid}`, game, 300);

    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—ç—à–∏
    this.cache.delete('games:active');
    this.cache.delete(`games:difficulty:${game.difficulty}`);

    return result;
  }
}
```

---

## 8. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 8.1 –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

```sql
-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_games_difficulty_completed ON games(difficulty, is_completed);
CREATE INDEX idx_games_created_at_difficulty ON games(created_at, difficulty);

-- –ü–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_games_list_view ON games(uuid, difficulty, is_completed, created_at, play_time);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
CREATE INDEX idx_games_play_time ON games(play_time) WHERE is_completed = 1;
```

### 8.2 –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

```typescript
interface PaginationOptions {
  limit: number;
  offset: number;
  sortBy?: 'created_at' | 'play_time' | 'updated_at';
  sortOrder?: 'ASC' | 'DESC';
}

class PaginatedGameRepository {
  async findGames(options: PaginationOptions): Promise<PaginatedResult<GameEntity>> {
    const { limit, offset, sortBy = 'created_at', sortOrder = 'DESC' } = options;

    const countSql = 'SELECT COUNT(*) as total FROM games';
    const gamesSql = `
      SELECT * FROM games
      ORDER BY ${sortBy} ${sortOrder}
      LIMIT ? OFFSET ?
    `;

    const [countResult, gamesResult] = await Promise.all([
      this.db.executeSql(countSql),
      this.db.executeSql(gamesSql, [limit, offset])
    ]);

    const total = countResult[0].rows.item(0).total;
    const games = this.mapRowsToEntities(gamesResult[0].rows);

    return {
      data: games,
      total,
      hasMore: offset + limit < total,
      page: Math.floor(offset / limit) + 1,
      totalPages: Math.ceil(total / limit)
    };
  }
}
```

### 8.3 Batch –æ–ø–µ—Ä–∞—Ü–∏–∏

```typescript
class BatchGameOperations {
  async saveMultiple(games: GameEntity[]): Promise<void> {
    await this.db.transaction(async (tx) => {
      for (const game of games) {
        await this.saveInTransaction(tx, game);
      }
    });
  }

  async deleteMultiple(gameIds: string[]): Promise<void> {
    const placeholders = gameIds.map(() => '?').join(',');
    const sql = `DELETE FROM games WHERE uuid IN (${placeholders})`;

    await this.db.executeSql(sql, gameIds);
  }

  async bulkUpdateStatistics(updates: StatisticsUpdate[]): Promise<void> {
    await this.db.transaction(async (tx) => {
      for (const update of updates) {
        await this.updateStatisticsInTransaction(tx, update);
      }
    });
  }
}
```

---

## 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 9.1 –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```typescript
class DatabaseMetrics {
  static async collectMetrics(): Promise<DatabaseStats> {
    const [gameCount, dbSize, indexStats] = await Promise.all([
      this.getTableRowCount('games'),
      this.getDatabaseSize(),
      this.getIndexUsageStats()
    ]);

    return {
      totalGames: gameCount,
      databaseSizeMB: dbSize / (1024 * 1024),
      indexEfficiency: indexStats,
      lastOptimization: await this.getLastOptimizationTime()
    };
  }

  static async optimizeDatabase(): Promise<void> {
    await this.db.executeSql('VACUUM');
    await this.db.executeSql('ANALYZE');

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    await AsyncStorage.setItem('db:last_optimization', Date.now().toString());
  }
}
```

### 9.2 –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

```typescript
class DatabaseDiagnostic {
  static async checkIntegrity(): Promise<IntegrityReport> {
    const integrityResult = await this.db.executeSql('PRAGMA integrity_check');
    const orphanedMoves = await this.findOrphanedMoves();
    const duplicateUUIDs = await this.findDuplicateUUIDs();

    return {
      isHealthy: integrityResult[0].rows.item(0)['integrity_check'] === 'ok',
      orphanedMoves: orphanedMoves.length,
      duplicateUUIDs: duplicateUUIDs.length,
      recommendations: this.generateRecommendations()
    };
  }

  static async repair(): Promise<void> {
    // –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ —Ö–æ–¥—ã
    await this.db.executeSql(`
      DELETE FROM game_moves
      WHERE game_id NOT IN (SELECT id FROM games)
    `);

    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã UUID
    await this.fixDuplicateUUIDs();

    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    await this.recalculateStatistics();
  }
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∏—è

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤–æ–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, –∫–æ–≥–¥–∞:**
1. ‚úÖ –í—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏–º–µ—é—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
2. ‚úÖ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π
4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã Repository –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
6. ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
7. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–ª–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üéØ –°–≤–æ–¥–∫–∞ —Ä–µ—à–µ–Ω–∏–π

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –†–µ—à–µ–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|------------|---------|-------------|
| **–ò–≥—Ä—ã –∏ —Ö–æ–¥—ã** | SQLite | –°–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, SQL –∑–∞–ø—Ä–æ—Å—ã |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | SQLite | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** | AsyncStorage | –ü—Ä–æ—Å—Ç—ã–µ key-value, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
| **–ö—ç—à** | MMKV | –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API |
| **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** | File System | –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö |

### –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã:
- **SQLite**: ~1-2 MB
- **AsyncStorage**: ~100 KB
- **MMKV**: ~200 KB
- **–û–±—â–∏–π overhead**: ~1.5-2.5 MB

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
1. **2.1.5** - –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
2. **2.2.1** - –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
3. **3.1.1** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ