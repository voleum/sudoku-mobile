# 2.2.2 Определение компонентной структуры

## Статус: ✅ Завершено
**Дата начала**: 19 сентября 2025
**Дата завершения**: 19 сентября 2025
**Ответственный**: voleum

---

## Общие принципы компонентной архитектуры

### 🎯 Принципы проектирования компонентов

**Основные принципы:**
1. **Single Responsibility** - каждый компонент отвечает за одну задачу
2. **Composition over Inheritance** - композиция компонентов вместо наследования
3. **Props Interface** - четкие и типизированные интерфейсы
4. **Reusability** - максимальное переиспользование
5. **Performance** - оптимизация рендеринга (React.memo, useMemo)
6. **Accessibility** - поддержка screen readers и других assistive technologies

**Архитектурные паттерны:**
- **Container/Presentation** - разделение логики и представления
- **Higher-Order Components** - для кросс-функциональности
- **Compound Components** - для сложных интерфейсов
- **Render Props** - для гибкого переиспользования логики

---

## 📱 Структура экранов и компонентов

### 1. Home Stack (Главный экран)

```typescript
// src/presentation/screens/Home/
┌─────────────────────────────────────────────────────────────────────┐
│                           HOME STACK                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                     HomeScreen                              │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ WelcomeHeader │ user: User? │ Приветственный заголовок│  │    │
│  │  │ QuickStartBtn │ onPress()   │ Быстрая игра            │  │    │
│  │  │ DifficultyCard│ level, stats│ Карточка сложности      │  │    │
│  │  │ ContinueGameBtn│ game?, onPress│ Продолжить игру      │  │    │
│  │  │ StatsPreview  │ statistics  │ Краткая статистика      │  │    │
│  │  │ SettingsBtn   │ onPress()   │ Кнопка настроек         │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │             DifficultySelectionScreen                       │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ ScreenHeader  │ title, back │ Заголовок экрана        │  │    │
│  │  │ DifficultyCard│ level, stats│ Детальная карточка      │  │    │
│  │  │ PreviewGrid   │ sample      │ Пример пазла            │  │    │
│  │  │ StartGameBtn  │ difficulty  │ Начать игру             │  │    │
│  │  │ BestTimesBadge│ times[]     │ Лучшие времена          │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                  SavedGamesScreen                           │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ GamesList     │ games[]     │ Список сохраненных игр  │  │    │
│  │  │ GameCard      │ game, actions│ Карточка игры          │  │    │
│  │  │ EmptyState    │ onStartNew  │ Пустое состояние        │  │    │
│  │  │ FilterTabs    │ filters     │ Фильтры по сложности    │  │    │
│  │  │ SearchBar     │ query, onChange│ Поиск игр            │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

### 2. Game Stack (Игровые экраны)

```typescript
// src/presentation/screens/Game/
┌─────────────────────────────────────────────────────────────────────┐
│                           GAME STACK                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                      GameScreen                             │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ GameHeader    │ game, timer │ Информация об игре      │  │    │
│  │  │ SudokuBoard   │ grid, events│ Игровое поле 9x9        │  │    │
│  │  │ NumberPad     │ onSelect    │ Панель ввода цифр       │  │    │
│  │  │ GameControls  │ actions     │ Контрольные кнопки      │  │    │
│  │  │ HintButton    │ onHint      │ Кнопка подсказки        │  │    │
│  │  │ UndoButton    │ onUndo      │ Кнопка отмены           │  │    │
│  │  │ PauseButton   │ onPause     │ Кнопка паузы            │  │    │
│  │  │ ProgressBar   │ completion  │ Индикатор прогресса     │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                     PauseScreen                             │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ PauseOverlay  │ game        │ Затемненный фон         │  │    │
│  │  │ GamePreview   │ grid        │ Миниатюра игры          │  │    │
│  │  │ ResumeButton  │ onResume    │ Продолжить игру         │  │    │
│  │  │ SaveButton    │ onSave      │ Сохранить игру          │  │    │
│  │  │ HomeButton    │ onHome      │ Вернуться домой         │  │    │
│  │  │ SettingsBtn   │ onSettings  │ Настройки               │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                    VictoryScreen                            │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ CelebrationAnim│ trigger    │ Анимация празднования   │  │    │
│  │  │ CompletedGrid │ solution    │ Решенная сетка          │  │    │
│  │  │ GameStats     │ time, moves │ Статистика игры         │  │    │
│  │  │ AchievementBadge│ badges[]  │ Полученные достижения   │  │    │
│  │  │ NewGameButton │ difficulty  │ Новая игра              │  │    │
│  │  │ ShareButton   │ stats       │ Поделиться результатом  │  │    │
│  │  │ HomeButton    │ onHome      │ Главное меню            │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

### 3. Settings Stack (Настройки)

```typescript
// src/presentation/screens/Settings/
┌─────────────────────────────────────────────────────────────────────┐
│                         SETTINGS STACK                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                    SettingsScreen                           │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ SettingsGroup │ title, items│ Группа настроек         │  │    │
│  │  │ ToggleItem    │ value, onToggle│ Переключатель        │  │    │
│  │  │ SelectItem    │ options, value│ Выбор из списка       │  │    │
│  │  │ SliderItem    │ value, range│ Ползунок               │  │    │
│  │  │ ActionItem    │ onPress     │ Действие               │  │    │
│  │  │ InfoItem      │ text        │ Информационный пункт    │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                ThemeSelectionScreen                         │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ ThemeCard     │ theme, active│ Карточка темы          │  │    │
│  │  │ ThemePreview  │ colors      │ Превью темы             │  │    │
│  │  │ CustomThemeBtn│ onCustom    │ Создать тему            │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                     AboutScreen                             │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ AppLogo       │ version     │ Логотип приложения      │  │    │
│  │  │ AppInfo       │ details     │ Информация о приложении │  │    │
│  │  │ DeveloperInfo │ contact     │ Информация о разработчике│ │    │
│  │  │ LicenseInfo   │ licenses    │ Лицензии                │  │    │
│  │  │ RateAppBtn    │ onRate      │ Оценить приложение      │  │    │
│  │  │ FeedbackBtn   │ onFeedback  │ Обратная связь          │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

### 4. Statistics Stack (Статистика)

```typescript
// src/presentation/screens/Statistics/
┌─────────────────────────────────────────────────────────────────────┐
│                       STATISTICS STACK                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                   StatisticsScreen                          │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ StatsOverview │ totalStats  │ Общая статистика        │  │    │
│  │  │ DifficultyTabs│ onTabChange │ Вкладки сложности       │  │    │
│  │  │ StatCard      │ label, value│ Карточка статистики     │  │    │
│  │  │ ProgressChart │ data, type  │ График прогресса        │  │    │
│  │  │ BestTimesTable│ times[]     │ Таблица лучших времен   │  │    │
│  │  │ StreakBadge   │ current, best│ Значок серии           │  │    │
│  │  │ ResetStatsBtn │ onReset     │ Сброс статистики        │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                 AchievementsScreen                          │    │
│  │  ┌───────────────┬─────────────┬─────────────────────────┐  │    │
│  │  │   Component   │    Props    │      Description        │  │    │
│  │  ├───────────────┼─────────────┼─────────────────────────┤  │    │
│  │  │ AchievementCard│ achievement │ Карточка достижения     │  │    │
│  │  │ ProgressBadge │ progress    │ Индикатор прогресса     │  │    │
│  │  │ CategoryTabs  │ categories  │ Категории достижений    │  │    │
│  │  │ RewardModal   │ reward      │ Модал награды           │  │    │
│  │  └───────────────┴─────────────┴─────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🧩 Игровые компоненты (Game Components)

### 1. SudokuBoard - Основное игровое поле

```typescript
// src/presentation/components/game/SudokuBoard.tsx
interface SudokuBoardProps {
  grid: SudokuGrid;
  originalGrid: SudokuGrid;
  selectedCell: CellPosition | null;
  highlightedCells: CellPosition[];
  errorCells: CellPosition[];
  hintCells: CellPosition[];
  notes: NotesGrid;
  showNotes: boolean;
  onCellPress: (row: number, col: number) => void;
  onCellLongPress: (row: number, col: number) => void;
  disabled?: boolean;
  animationMode?: 'none' | 'smooth' | 'celebration';
}

const SudokuBoard: React.FC<SudokuBoardProps> = ({
  grid,
  originalGrid,
  selectedCell,
  highlightedCells,
  errorCells,
  hintCells,
  notes,
  showNotes,
  onCellPress,
  onCellLongPress,
  disabled = false,
  animationMode = 'smooth'
}) => {
  // Мемоизация для оптимизации производительности
  const cellComponents = useMemo(() =>
    grid.map((row, rowIndex) =>
      row.map((cell, colIndex) => (
        <SudokuCell
          key={`${rowIndex}-${colIndex}`}
          value={cell}
          row={rowIndex}
          col={colIndex}
          isFixed={originalGrid[rowIndex][colIndex] !== 0}
          isSelected={selectedCell?.row === rowIndex && selectedCell?.col === colIndex}
          isHighlighted={highlightedCells.some(pos => pos.row === rowIndex && pos.col === colIndex)}
          hasError={errorCells.some(pos => pos.row === rowIndex && pos.col === colIndex)}
          isHint={hintCells.some(pos => pos.row === rowIndex && pos.col === colIndex)}
          notes={showNotes ? notes[rowIndex][colIndex] : []}
          onPress={() => onCellPress(rowIndex, colIndex)}
          onLongPress={() => onCellLongPress(rowIndex, colIndex)}
          disabled={disabled}
          animationMode={animationMode}
        />
      ))
    ), [grid, originalGrid, selectedCell, highlightedCells, errorCells, hintCells, notes, showNotes, onCellPress, onCellLongPress, disabled, animationMode]
  );

  return (
    <View style={styles.board} testID="sudoku-board">
      <BoardBackground />
      <BoardGrid>
        {cellComponents}
      </BoardGrid>
      <BoardLines />
    </View>
  );
};
```

### 2. SudokuCell - Отдельная ячейка

```typescript
// src/presentation/components/game/SudokuCell.tsx
interface SudokuCellProps {
  value: CellValue;
  row: number;
  col: number;
  isFixed: boolean;
  isSelected: boolean;
  isHighlighted: boolean;
  hasError: boolean;
  isHint: boolean;
  notes: number[];
  onPress: () => void;
  onLongPress: () => void;
  disabled?: boolean;
  animationMode?: 'none' | 'smooth' | 'celebration';
}

const SudokuCell: React.FC<SudokuCellProps> = React.memo(({
  value,
  row,
  col,
  isFixed,
  isSelected,
  isHighlighted,
  hasError,
  isHint,
  notes,
  onPress,
  onLongPress,
  disabled = false,
  animationMode = 'smooth'
}) => {
  // Анимации с React Native Reanimated
  const scaleValue = useSharedValue(1);
  const backgroundColorValue = useSharedValue(0);
  const borderColorValue = useSharedValue(0);

  const animatedStyle = useAnimatedStyle(() => ({
    transform: [{ scale: scaleValue.value }],
    backgroundColor: interpolateColor(
      backgroundColorValue.value,
      [0, 1, 2, 3],
      [colors.cell.normal, colors.cell.selected, colors.cell.highlighted, colors.cell.error]
    ),
    borderColor: interpolateColor(
      borderColorValue.value,
      [0, 1, 2],
      [colors.border.normal, colors.border.selected, colors.border.error]
    )
  }));

  // Обработка нажатий с тактильной обратной связью
  const handlePress = useCallback(() => {
    if (disabled) return;

    // Анимация нажатия
    scaleValue.value = withSequence(
      withTiming(0.9, { duration: 100 }),
      withTiming(1, { duration: 100 })
    );

    // Вибрация
    Haptics.selectionAsync();

    onPress();
  }, [disabled, onPress, scaleValue]);

  const handleLongPress = useCallback(() => {
    if (disabled) return;

    // Вибрация для долгого нажатия
    Haptics.mediumImpactAsync();

    onLongPress();
  }, [disabled, onLongPress]);

  // Обновление анимаций при изменении состояния
  useEffect(() => {
    if (isSelected) {
      backgroundColorValue.value = withTiming(1);
      borderColorValue.value = withTiming(1);
    } else if (hasError) {
      backgroundColorValue.value = withTiming(3);
      borderColorValue.value = withTiming(2);
    } else if (isHighlighted) {
      backgroundColorValue.value = withTiming(2);
      borderColorValue.value = withTiming(0);
    } else {
      backgroundColorValue.value = withTiming(0);
      borderColorValue.value = withTiming(0);
    }
  }, [isSelected, hasError, isHighlighted, backgroundColorValue, borderColorValue]);

  return (
    <Animated.View
      style={[styles.cell, animatedStyle]}
      testID={`cell-${row}-${col}`}
    >
      <TouchableOpacity
        onPress={handlePress}
        onLongPress={handleLongPress}
        style={styles.touchArea}
        activeOpacity={0.7}
      >
        {value !== 0 ? (
          <Text style={[
            styles.cellText,
            isFixed && styles.fixedText,
            isHint && styles.hintText,
            hasError && styles.errorText
          ]}>
            {value}
          </Text>
        ) : (
          notes.length > 0 && (
            <NotesGrid notes={notes} />
          )
        )}
        {isHint && <HintIndicator />}
      </TouchableOpacity>
    </Animated.View>
  );
});
```

### 3. NumberPad - Панель ввода цифр

```typescript
// src/presentation/components/game/NumberPad.tsx
interface NumberPadProps {
  onNumberPress: (number: number) => void;
  onClearPress: () => void;
  onNotesToggle: () => void;
  isNotesMode: boolean;
  availableNumbers: number[];
  usedNumbers: { [key: number]: number };
  disabled?: boolean;
  layout?: 'grid' | 'horizontal';
}

const NumberPad: React.FC<NumberPadProps> = ({
  onNumberPress,
  onClearPress,
  onNotesToggle,
  isNotesMode,
  availableNumbers,
  usedNumbers,
  disabled = false,
  layout = 'grid'
}) => {
  const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];

  const renderNumberButton = useCallback((number: number) => {
    const isAvailable = availableNumbers.includes(number);
    const usageCount = usedNumbers[number] || 0;
    const isCompleted = usageCount >= 9;

    return (
      <NumberButton
        key={number}
        number={number}
        onPress={() => onNumberPress(number)}
        disabled={disabled || !isAvailable}
        isCompleted={isCompleted}
        usageCount={usageCount}
        isNotesMode={isNotesMode}
      />
    );
  }, [availableNumbers, usedNumbers, disabled, isNotesMode, onNumberPress]);

  return (
    <View style={[styles.numberPad, styles[layout]]} testID="number-pad">
      <View style={styles.numbersGrid}>
        {numbers.map(renderNumberButton)}
      </View>

      <View style={styles.actionButtons}>
        <ActionButton
          icon="eraser"
          onPress={onClearPress}
          disabled={disabled}
          testID="clear-button"
        />
        <ActionButton
          icon="edit"
          onPress={onNotesToggle}
          disabled={disabled}
          isActive={isNotesMode}
          testID="notes-button"
        />
      </View>
    </View>
  );
};
```

### 4. GameControls - Контрольные элементы

```typescript
// src/presentation/components/game/GameControls.tsx
interface GameControlsProps {
  onPause: () => void;
  onUndo: () => void;
  onHint: () => void;
  onRestart: () => void;
  canUndo: boolean;
  hintsRemaining: number;
  disabled?: boolean;
  layout?: 'horizontal' | 'vertical';
}

const GameControls: React.FC<GameControlsProps> = ({
  onPause,
  onUndo,
  onHint,
  onRestart,
  canUndo,
  hintsRemaining,
  disabled = false,
  layout = 'horizontal'
}) => {
  return (
    <View style={[styles.controls, styles[layout]]} testID="game-controls">
      <ControlButton
        icon="pause"
        onPress={onPause}
        disabled={disabled}
        tooltip="Пауза"
        testID="pause-button"
      />

      <ControlButton
        icon="undo"
        onPress={onUndo}
        disabled={disabled || !canUndo}
        tooltip="Отменить ход"
        testID="undo-button"
      />

      <ControlButton
        icon="lightbulb"
        onPress={onHint}
        disabled={disabled || hintsRemaining <= 0}
        badge={hintsRemaining}
        tooltip={`Подсказка (${hintsRemaining})`}
        testID="hint-button"
      />

      <ControlButton
        icon="refresh"
        onPress={onRestart}
        disabled={disabled}
        tooltip="Начать заново"
        confirmAction
        testID="restart-button"
      />
    </View>
  );
};
```

---

## 🎨 Переиспользуемые UI компоненты

### 1. Button Components

```typescript
// src/presentation/components/ui/Button/

interface BaseButtonProps {
  onPress: () => void;
  disabled?: boolean;
  loading?: boolean;
  testID?: string;
  style?: ViewStyle;
  children: React.ReactNode;
}

// PrimaryButton - основная кнопка
interface PrimaryButtonProps extends BaseButtonProps {
  title: string;
  size?: 'small' | 'medium' | 'large';
  variant?: 'solid' | 'outline' | 'ghost';
  leftIcon?: string;
  rightIcon?: string;
}

// IconButton - кнопка с иконкой
interface IconButtonProps extends BaseButtonProps {
  icon: string;
  size?: number;
  badge?: number | string;
  tooltip?: string;
  confirmAction?: boolean;
}

// FloatingActionButton - плавающая кнопка
interface FABProps extends BaseButtonProps {
  icon: string;
  position?: 'bottom-right' | 'bottom-left' | 'center';
  extended?: boolean;
  label?: string;
}
```

### 2. Card Components

```typescript
// src/presentation/components/ui/Card/

interface BaseCardProps {
  children: React.ReactNode;
  onPress?: () => void;
  style?: ViewStyle;
  testID?: string;
}

// GameCard - карточка игры
interface GameCardProps extends BaseCardProps {
  game: GameEntity;
  onPlay: () => void;
  onDelete: () => void;
  onShare?: () => void;
  showActions?: boolean;
}

// DifficultyCard - карточка уровня сложности
interface DifficultyCardProps extends BaseCardProps {
  difficulty: DifficultyLevel;
  statistics: DifficultyStatistics;
  onSelect: () => void;
  isSelected?: boolean;
  showPreview?: boolean;
}

// StatCard - карточка статистики
interface StatCardProps extends BaseCardProps {
  label: string;
  value: string | number;
  icon?: string;
  trend?: 'up' | 'down' | 'neutral';
  color?: string;
}
```

### 3. Modal Components

```typescript
// src/presentation/components/ui/Modal/

interface BaseModalProps {
  visible: boolean;
  onClose: () => void;
  children: React.ReactNode;
  animationType?: 'slide' | 'fade' | 'none';
  position?: 'center' | 'bottom' | 'top';
}

// ConfirmModal - модал подтверждения
interface ConfirmModalProps extends BaseModalProps {
  title: string;
  message: string;
  onConfirm: () => void;
  confirmText?: string;
  cancelText?: string;
  type?: 'info' | 'warning' | 'error' | 'success';
}

// ActionSheetModal - модал с действиями
interface ActionSheetModalProps extends BaseModalProps {
  title?: string;
  actions: ActionSheetAction[];
  cancelAction?: ActionSheetAction;
}

interface ActionSheetAction {
  title: string;
  onPress: () => void;
  icon?: string;
  destructive?: boolean;
  disabled?: boolean;
}
```

### 4. Input Components

```typescript
// src/presentation/components/ui/Input/

interface BaseInputProps {
  value: string;
  onChangeText: (text: string) => void;
  placeholder?: string;
  disabled?: boolean;
  error?: string;
  testID?: string;
}

// TextInput - текстовое поле
interface TextInputProps extends BaseInputProps {
  label?: string;
  leftIcon?: string;
  rightIcon?: string;
  secureTextEntry?: boolean;
  multiline?: boolean;
  maxLength?: number;
}

// SearchInput - поле поиска
interface SearchInputProps extends BaseInputProps {
  onSearch: (query: string) => void;
  onClear: () => void;
  showClearButton?: boolean;
  suggestions?: string[];
}

// SelectInput - выбор из списка
interface SelectInputProps {
  value: string;
  options: SelectOption[];
  onSelect: (value: string) => void;
  placeholder?: string;
  label?: string;
  disabled?: boolean;
  error?: string;
}

interface SelectOption {
  label: string;
  value: string;
  icon?: string;
  disabled?: boolean;
}
```

---

## 🪝 Custom Hooks

### 1. Game Logic Hooks

```typescript
// src/presentation/hooks/useGame.ts
interface UseGameReturn {
  currentGame: GameEntity | null;
  isLoading: boolean;
  error: string | null;

  // Actions
  startNewGame: (difficulty: DifficultyLevel) => Promise<void>;
  makeMove: (row: number, col: number, value: number) => Promise<void>;
  addNote: (row: number, col: number, note: number) => void;
  removeNote: (row: number, col: number, note: number) => void;
  useHint: () => Promise<void>;
  undoMove: () => void;
  pauseGame: () => void;
  resumeGame: () => void;
  saveGame: () => Promise<void>;

  // State
  selectedCell: CellPosition | null;
  isNotesMode: boolean;
  isPaused: boolean;
  isCompleted: boolean;
  hintsRemaining: number;
  canUndo: boolean;

  // Helper functions
  selectCell: (row: number, col: number) => void;
  clearCell: () => void;
  toggleNotesMode: () => void;
  getAvailableNumbers: (row: number, col: number) => number[];
  getCellErrors: () => CellPosition[];
  getHighlightedCells: () => CellPosition[];
}

export const useGame = (): UseGameReturn => {
  const gameStore = useGameStore();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Implementation...
};

// src/presentation/hooks/useTimer.ts
interface UseTimerReturn {
  time: number;
  formattedTime: string;
  isRunning: boolean;
  start: () => void;
  pause: () => void;
  resume: () => void;
  reset: () => void;
  stop: () => void;
}

export const useTimer = (initialTime: number = 0): UseTimerReturn => {
  // Implementation...
};

// src/presentation/hooks/useGameValidation.ts
interface UseGameValidationReturn {
  validateMove: (row: number, col: number, value: number) => boolean;
  findConflicts: (grid: SudokuGrid) => CellPosition[];
  isGameComplete: (grid: SudokuGrid) => boolean;
  getHint: (grid: SudokuGrid, solution: SudokuGrid) => CellPosition | null;
  checkWinCondition: (grid: SudokuGrid) => boolean;
}

export const useGameValidation = (): UseGameValidationReturn => {
  // Implementation...
};
```

### 2. UI State Hooks

```typescript
// src/presentation/hooks/useUI.ts
interface UseUIReturn {
  // Loading states
  isLoading: boolean;
  setLoading: (loading: boolean) => void;

  // Modal states
  modals: ModalState;
  showModal: (modalName: string, props?: any) => void;
  hideModal: (modalName: string) => void;

  // Toast notifications
  showToast: (message: string, type?: ToastType) => void;

  // Keyboard
  keyboardHeight: number;
  isKeyboardVisible: boolean;

  // Orientation
  orientation: 'portrait' | 'landscape';
  screenSize: { width: number; height: number };
}

// src/presentation/hooks/useTheme.ts
interface UseThemeReturn {
  colors: ColorScheme;
  spacing: SpacingScheme;
  typography: TypographyScheme;
  currentTheme: ThemeName;
  isDarkMode: boolean;
  setTheme: (theme: ThemeName) => void;
  toggleDarkMode: () => void;
}

// src/presentation/hooks/useAnimation.ts
interface UseAnimationReturn {
  // Scale animations
  scaleIn: (duration?: number) => void;
  scaleOut: (duration?: number) => void;
  pulseScale: (scale?: number) => void;

  // Fade animations
  fadeIn: (duration?: number) => void;
  fadeOut: (duration?: number) => void;

  // Slide animations
  slideIn: (direction: 'left' | 'right' | 'up' | 'down') => void;
  slideOut: (direction: 'left' | 'right' | 'up' | 'down') => void;

  // Values
  animatedValues: {
    scale: SharedValue<number>;
    opacity: SharedValue<number>;
    translateX: SharedValue<number>;
    translateY: SharedValue<number>;
  };
}
```

### 3. Data Hooks

```typescript
// src/presentation/hooks/useStatistics.ts
interface UseStatisticsReturn {
  statistics: StatisticsEntity[];
  overallStats: OverallStatistics;
  isLoading: boolean;
  error: string | null;

  // Actions
  getStatistics: (difficulty?: DifficultyLevel) => Promise<void>;
  updateStatistics: (gameResult: GameResult) => Promise<void>;
  resetStatistics: (difficulty?: DifficultyLevel) => Promise<void>;

  // Computed values
  getBestTime: (difficulty: DifficultyLevel) => number;
  getCompletionRate: (difficulty: DifficultyLevel) => number;
  getCurrentStreak: (difficulty: DifficultyLevel) => number;
  getAverageTime: (difficulty: DifficultyLevel) => number;
}

// src/presentation/hooks/useSettings.ts
interface UseSettingsReturn {
  settings: SettingsEntity;
  isLoading: boolean;
  error: string | null;

  // Actions
  updateSetting: <K extends keyof SettingsEntity>(
    key: K,
    value: SettingsEntity[K]
  ) => Promise<void>;
  resetSettings: () => Promise<void>;

  // Specific settings
  theme: ThemeName;
  language: Language;
  soundEnabled: boolean;
  vibrationEnabled: boolean;
  showHints: boolean;
  showErrors: boolean;
}

// src/presentation/hooks/useSavedGames.ts
interface UseSavedGamesReturn {
  savedGames: GameEntity[];
  isLoading: boolean;
  error: string | null;

  // Actions
  loadSavedGames: () => Promise<void>;
  saveGame: (game: GameEntity) => Promise<void>;
  deleteGame: (gameId: string) => Promise<void>;
  loadGame: (gameId: string) => Promise<GameEntity>;

  // Filters
  filterByDifficulty: (difficulty?: DifficultyLevel) => GameEntity[];
  searchGames: (query: string) => GameEntity[];
  sortGames: (sortBy: 'date' | 'difficulty' | 'progress') => GameEntity[];
}
```

---

## 📁 Детальная файловая структура

```
src/
├── presentation/
│   ├── screens/                          # Экраны приложения
│   │   ├── Home/
│   │   │   ├── HomeScreen.tsx
│   │   │   ├── DifficultySelectionScreen.tsx
│   │   │   ├── SavedGamesScreen.tsx
│   │   │   └── index.ts
│   │   ├── Game/
│   │   │   ├── GameScreen.tsx
│   │   │   ├── PauseScreen.tsx
│   │   │   ├── VictoryScreen.tsx
│   │   │   └── index.ts
│   │   ├── Settings/
│   │   │   ├── SettingsScreen.tsx
│   │   │   ├── ThemeSelectionScreen.tsx
│   │   │   ├── AboutScreen.tsx
│   │   │   └── index.ts
│   │   └── Statistics/
│   │       ├── StatisticsScreen.tsx
│   │       ├── AchievementsScreen.tsx
│   │       └── index.ts
│   │
│   ├── components/                       # React компоненты
│   │   ├── ui/                          # Базовые UI компоненты
│   │   │   ├── Button/
│   │   │   │   ├── PrimaryButton.tsx
│   │   │   │   ├── IconButton.tsx
│   │   │   │   ├── FloatingActionButton.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── Card/
│   │   │   │   ├── BaseCard.tsx
│   │   │   │   ├── GameCard.tsx
│   │   │   │   ├── DifficultyCard.tsx
│   │   │   │   ├── StatCard.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── Modal/
│   │   │   │   ├── BaseModal.tsx
│   │   │   │   ├── ConfirmModal.tsx
│   │   │   │   ├── ActionSheetModal.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── Input/
│   │   │   │   ├── TextInput.tsx
│   │   │   │   ├── SearchInput.tsx
│   │   │   │   ├── SelectInput.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── Progress/
│   │   │   │   ├── ProgressBar.tsx
│   │   │   │   ├── CircularProgress.tsx
│   │   │   │   ├── LoadingSpinner.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── Typography/
│   │   │   │   ├── Text.tsx
│   │   │   │   ├── Heading.tsx
│   │   │   │   ├── Caption.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   └── Layout/
│   │   │       ├── ScreenContainer.tsx
│   │   │       ├── SafeAreaContainer.tsx
│   │   │       ├── KeyboardAvoidingContainer.tsx
│   │   │       ├── styles.ts
│   │   │       └── index.ts
│   │   │
│   │   ├── game/                        # Игровые компоненты
│   │   │   ├── SudokuBoard/
│   │   │   │   ├── SudokuBoard.tsx
│   │   │   │   ├── BoardBackground.tsx
│   │   │   │   ├── BoardGrid.tsx
│   │   │   │   ├── BoardLines.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── SudokuCell/
│   │   │   │   ├── SudokuCell.tsx
│   │   │   │   ├── NotesGrid.tsx
│   │   │   │   ├── HintIndicator.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── NumberPad/
│   │   │   │   ├── NumberPad.tsx
│   │   │   │   ├── NumberButton.tsx
│   │   │   │   ├── ActionButton.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── GameHeader/
│   │   │   │   ├── GameHeader.tsx
│   │   │   │   ├── Timer.tsx
│   │   │   │   ├── DifficultyBadge.tsx
│   │   │   │   ├── ProgressIndicator.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   ├── GameControls/
│   │   │   │   ├── GameControls.tsx
│   │   │   │   ├── ControlButton.tsx
│   │   │   │   ├── styles.ts
│   │   │   │   └── index.ts
│   │   │   └── Animations/
│   │   │       ├── CelebrationAnimation.tsx
│   │   │       ├── HintAnimation.tsx
│   │   │       ├── ErrorAnimation.tsx
│   │   │       └── index.ts
│   │   │
│   │   └── common/                      # Общие компоненты
│   │       ├── Header/
│   │       │   ├── ScreenHeader.tsx
│   │       │   ├── NavigationHeader.tsx
│   │       │   ├── styles.ts
│   │       │   └── index.ts
│   │       ├── ErrorBoundary/
│   │       │   ├── ErrorBoundary.tsx
│   │       │   ├── ErrorFallback.tsx
│   │       │   └── index.ts
│   │       ├── EmptyState/
│   │       │   ├── EmptyState.tsx
│   │       │   ├── styles.ts
│   │       │   └── index.ts
│   │       └── Toast/
│   │           ├── Toast.tsx
│   │           ├── ToastContainer.tsx
│   │           ├── styles.ts
│   │           └── index.ts
│   │
│   ├── navigation/                      # Навигация
│   │   ├── AppNavigator.tsx
│   │   ├── HomeStackNavigator.tsx
│   │   ├── GameStackNavigator.tsx
│   │   ├── SettingsStackNavigator.tsx
│   │   ├── StatisticsStackNavigator.tsx
│   │   ├── TabNavigator.tsx
│   │   ├── types.ts
│   │   └── index.ts
│   │
│   ├── hooks/                          # Custom hooks
│   │   ├── game/
│   │   │   ├── useGame.ts
│   │   │   ├── useTimer.ts
│   │   │   ├── useGameValidation.ts
│   │   │   ├── useGameHistory.ts
│   │   │   └── index.ts
│   │   ├── ui/
│   │   │   ├── useUI.ts
│   │   │   ├── useTheme.ts
│   │   │   ├── useAnimation.ts
│   │   │   ├── useKeyboard.ts
│   │   │   ├── useOrientation.ts
│   │   │   └── index.ts
│   │   ├── data/
│   │   │   ├── useStatistics.ts
│   │   │   ├── useSettings.ts
│   │   │   ├── useSavedGames.ts
│   │   │   ├── useAchievements.ts
│   │   │   └── index.ts
│   │   └── utils/
│   │       ├── useDebounce.ts
│   │       ├── useAsyncState.ts
│   │       ├── usePrevious.ts
│   │       ├── useMount.ts
│   │       └── index.ts
│   │
│   └── styles/                         # Стили и темы
│       ├── themes/
│       │   ├── light.ts
│       │   ├── dark.ts
│       │   ├── index.ts
│       │   └── types.ts
│       ├── colors.ts
│       ├── typography.ts
│       ├── spacing.ts
│       ├── dimensions.ts
│       └── index.ts
```

---

## 🎨 Система стилей и тем

### 1. Theme System

```typescript
// src/presentation/styles/themes/types.ts
export interface ColorScheme {
  primary: {
    main: string;
    light: string;
    dark: string;
    contrast: string;
  };
  secondary: {
    main: string;
    light: string;
    dark: string;
    contrast: string;
  };
  background: {
    default: string;
    paper: string;
    elevated: string;
  };
  surface: {
    default: string;
    elevated1: string;
    elevated2: string;
    elevated3: string;
  };
  text: {
    primary: string;
    secondary: string;
    disabled: string;
    hint: string;
  };
  game: {
    board: {
      background: string;
      lines: {
        thick: string;
        thin: string;
      };
    };
    cell: {
      normal: string;
      selected: string;
      highlighted: string;
      error: string;
      fixed: string;
      hint: string;
    };
    numbers: {
      fixed: string;
      user: string;
      hint: string;
      error: string;
      notes: string;
    };
  };
  status: {
    success: string;
    warning: string;
    error: string;
    info: string;
  };
}

export interface TypographyScheme {
  h1: TextStyle;
  h2: TextStyle;
  h3: TextStyle;
  h4: TextStyle;
  h5: TextStyle;
  h6: TextStyle;
  body1: TextStyle;
  body2: TextStyle;
  caption: TextStyle;
  button: TextStyle;
  overline: TextStyle;
  game: {
    cellNumber: TextStyle;
    timer: TextStyle;
    score: TextStyle;
    notes: TextStyle;
  };
}

export interface SpacingScheme {
  xs: number;
  sm: number;
  md: number;
  lg: number;
  xl: number;
  xxl: number;
}

export interface Theme {
  name: ThemeName;
  colors: ColorScheme;
  typography: TypographyScheme;
  spacing: SpacingScheme;
  dimensions: DimensionsScheme;
}
```

### 2. Component Styling Patterns

```typescript
// src/presentation/styles/utils/createStyles.ts
import { StyleSheet, ViewStyle, TextStyle, ImageStyle } from 'react-native';

type NamedStyles<T> = { [P in keyof T]: ViewStyle | TextStyle | ImageStyle };

export const createStyles = <T extends NamedStyles<T>>(
  styles: T | ((theme: Theme) => T)
): T => {
  if (typeof styles === 'function') {
    const theme = useTheme();
    return StyleSheet.create(styles(theme));
  }
  return StyleSheet.create(styles);
};

// Использование:
const styles = createStyles((theme) => ({
  container: {
    flex: 1,
    backgroundColor: theme.colors.background.default,
    padding: theme.spacing.md,
  },
  title: {
    ...theme.typography.h1,
    color: theme.colors.text.primary,
    marginBottom: theme.spacing.lg,
  },
  button: {
    backgroundColor: theme.colors.primary.main,
    paddingHorizontal: theme.spacing.lg,
    paddingVertical: theme.spacing.md,
    borderRadius: 8,
  }
}));
```

### 3. Responsive Design

```typescript
// src/presentation/styles/utils/responsive.ts
import { Dimensions } from 'react-native';

const { width: screenWidth, height: screenHeight } = Dimensions.get('window');

export const breakpoints = {
  small: 360,
  medium: 768,
  large: 1024,
} as const;

export const isSmallScreen = screenWidth < breakpoints.medium;
export const isMediumScreen = screenWidth >= breakpoints.medium && screenWidth < breakpoints.large;
export const isLargeScreen = screenWidth >= breakpoints.large;

export const responsive = {
  width: (percentage: number) => (screenWidth * percentage) / 100,
  height: (percentage: number) => (screenHeight * percentage) / 100,
  scale: (size: number) => {
    const scale = screenWidth / 320; // base width
    return Math.round(size * scale);
  },
  moderateScale: (size: number, factor: number = 0.5) => {
    return size + (responsive.scale(size) - size) * factor;
  },
};

// Адаптивные стили для игрового поля
export const getBoardDimensions = () => {
  const padding = responsive.scale(20);
  const availableWidth = screenWidth - padding * 2;
  const boardSize = Math.min(availableWidth, screenHeight * 0.6);
  const cellSize = boardSize / 9;

  return {
    boardSize,
    cellSize,
    padding,
  };
};
```

---

## 🧪 Тестирование компонентов

### 1. Component Testing Strategy

```typescript
// __tests__/components/SudokuBoard.test.tsx
import React from 'react';
import { render, fireEvent } from '@testing-library/react-native';
import { SudokuBoard } from '../src/presentation/components/game/SudokuBoard';
import { createMockGrid } from '../src/shared/utils/testUtils';

describe('SudokuBoard', () => {
  const mockProps = {
    grid: createMockGrid(),
    originalGrid: createMockGrid(),
    selectedCell: null,
    highlightedCells: [],
    errorCells: [],
    hintCells: [],
    notes: Array(9).fill(Array(9).fill([])),
    showNotes: false,
    onCellPress: jest.fn(),
    onCellLongPress: jest.fn(),
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('renders 81 cells', () => {
    const { getAllByTestId } = render(<SudokuBoard {...mockProps} />);
    const cells = getAllByTestId(/cell-\d-\d/);
    expect(cells).toHaveLength(81);
  });

  it('calls onCellPress when cell is pressed', () => {
    const { getByTestId } = render(<SudokuBoard {...mockProps} />);
    const cell = getByTestId('cell-0-0');

    fireEvent.press(cell);

    expect(mockProps.onCellPress).toHaveBeenCalledWith(0, 0);
  });

  it('highlights selected cell', () => {
    const propsWithSelection = {
      ...mockProps,
      selectedCell: { row: 1, col: 1 },
    };

    const { getByTestId } = render(<SudokuBoard {...propsWithSelection} />);
    const selectedCell = getByTestId('cell-1-1');

    expect(selectedCell).toHaveStyle({ backgroundColor: expect.any(String) });
  });

  it('disables interaction when disabled prop is true', () => {
    const disabledProps = { ...mockProps, disabled: true };
    const { getByTestId } = render(<SudokuBoard {...disabledProps} />);
    const cell = getByTestId('cell-0-0');

    fireEvent.press(cell);

    expect(mockProps.onCellPress).not.toHaveBeenCalled();
  });
});
```

### 2. Hook Testing

```typescript
// __tests__/hooks/useGame.test.ts
import { renderHook, act } from '@testing-library/react-hooks';
import { useGame } from '../src/presentation/hooks/useGame';
import { TestWrapper } from '../src/shared/utils/testUtils';

describe('useGame', () => {
  it('initializes with null current game', () => {
    const { result } = renderHook(() => useGame(), {
      wrapper: TestWrapper,
    });

    expect(result.current.currentGame).toBeNull();
    expect(result.current.selectedCell).toBeNull();
    expect(result.current.isPaused).toBe(false);
  });

  it('starts new game correctly', async () => {
    const { result } = renderHook(() => useGame(), {
      wrapper: TestWrapper,
    });

    await act(async () => {
      await result.current.startNewGame('easy');
    });

    expect(result.current.currentGame).not.toBeNull();
    expect(result.current.currentGame?.difficulty).toBe('easy');
    expect(result.current.isLoading).toBe(false);
  });

  it('makes valid move', async () => {
    const { result } = renderHook(() => useGame(), {
      wrapper: TestWrapper,
    });

    // Start game first
    await act(async () => {
      await result.current.startNewGame('easy');
    });

    // Select cell
    act(() => {
      result.current.selectCell(0, 0);
    });

    expect(result.current.selectedCell).toEqual({ row: 0, col: 0 });

    // Make move
    await act(async () => {
      await result.current.makeMove(0, 0, 5);
    });

    expect(result.current.currentGame?.grid[0][0]).toBe(5);
  });
});
```

---

## ✅ Критерии готовности компонентной структуры

**Компонентная структура считается готовой, когда:**

1. ✅ **Экраны определены** - все основные экраны с их компонентами
2. ✅ **UI компоненты спроектированы** - переиспользуемые элементы интерфейса
3. ✅ **Игровые компоненты детализированы** - специфичные для Судоку компоненты
4. ✅ **Хуки созданы** - custom hooks для логики и состояния
5. ✅ **Типы определены** - TypeScript интерфейсы для всех компонентов
6. ✅ **Файловая структура организована** - четкая организация файлов
7. ✅ **Система стилей настроена** - темы, цвета, типографика
8. ✅ **Тестирование запланировано** - стратегия тестирования компонентов

### Метрики готовности

- **Покрытие экранов**: 4/4 стека экранов (100%)
- **Базовые компоненты**: 7 категорий UI компонентов
- **Игровые компоненты**: 6 специализированных компонентов
- **Custom hooks**: 12 хуков для разных аспектов
- **Стили**: Полная система тем и стилей
- **TypeScript**: 100% типизация всех интерфейсов

---

## 🚀 Следующие шаги

После утверждения компонентной структуры:

1. **2.2.3** - Планирование API (если потребуется)
2. **2.2.4** - Детализация схемы базы данных
3. **2.2.5** - Определение паттернов проектирования
4. **3.1.1** - Настройка проекта и среды разработки
5. **3.1.2** - Создание базовой структуры проекта

---

**Последнее обновление**: 19 сентября 2025
**Статус**: ✅ Завершено