# 2.2.3 –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: voleum

---

## –ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ API

### üéØ –û—Å–Ω–æ–≤–Ω–æ–π –≤—ã–≤–æ–¥

**–î–ª—è MVP –≤–µ—Ä—Å–∏–∏ –∏–≥—Ä—ã –°—É–¥–æ–∫—É API –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –°—É–¥–æ–∫—É - —ç—Ç–æ **offline-first –∏–≥—Ä–∞** —Å –ø–æ–ª–Ω–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–∑–ª–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–∂–∏–¥–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–≥—Ä–∞—Ç—å –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- MVP —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–µ

**–ù–û**: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥–æ—Ç–æ–≤–∞ –∫ –±—É–¥—É—â–µ–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—é API –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

---

## üìä –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö API —Ñ—É–Ω–∫—Ü–∏–π

### 1. –§—É–Ω–∫—Ü–∏–∏ –ù–ï —Ç—Ä–µ–±—É—é—â–∏–µ API (–õ–æ–∫–∞–ª—å–Ω—ã–µ)

```
‚úÖ CORE –§–£–ù–ö–¶–ò–ò (MVP)
‚îú‚îÄ‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–∑–ª–æ–≤ –°—É–¥–æ–∫—É
‚îú‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ö–æ–¥–æ–≤ –∏–≥—Ä–æ–∫–∞
‚îú‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä –ª–æ–∫–∞–ª—å–Ω–æ
‚îú‚îÄ‚îÄ –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω—ã–µ)
‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä
‚îî‚îÄ‚îÄ –¢–µ–º—ã –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** SQLite + AsyncStorage + MMKV

### 2. –§—É–Ω–∫—Ü–∏–∏ –¢–†–ï–ë–£–Æ–©–ò–ï API (–ë—É–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏)

```
üîÆ –†–ê–°–®–ò–†–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò (v2.0+)
‚îú‚îÄ‚îÄ –û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚îú‚îÄ‚îÄ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã
‚îú‚îÄ‚îÄ –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä —Ä–µ–∂–∏–º—ã
‚îú‚îÄ‚îÄ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã
‚îú‚îÄ‚îÄ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ –¢—É—Ä–Ω–∏—Ä—ã –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã
‚îî‚îÄ‚îÄ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```

**–ü–æ—Ç—Ä–µ–±—É–µ—Ç:** REST API + WebSocket + Push Notifications

### 3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```
üìà –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï
‚îú‚îÄ‚îÄ Firebase Analytics (—É–∂–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ Crashlytics (—É–∂–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ Performance Monitoring
‚îî‚îÄ‚îÄ Custom Events
```

**–°—Ç–∞—Ç—É—Å:** –ü–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è Firebase SDK –±–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ API

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ API

### 1. Repository Pattern —Å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–µ–π

```typescript
// –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–∂–µ –≥–æ—Ç–æ–≤–∞ –∫ API
// domain/interfaces/IGameRepository.ts
export interface IGameRepository {
  // –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (MVP)
  save(game: GameEntity): Promise<void>;
  findById(id: string): Promise<GameEntity | null>;
  findAll(): Promise<GameEntity[]>;
  delete(id: string): Promise<void>;

  // –ë—É–¥—É—â–∏–µ API –º–µ—Ç–æ–¥—ã
  syncWithCloud?(userId: string): Promise<void>;
  uploadGame?(game: GameEntity): Promise<string>;
  downloadGame?(gameId: string): Promise<GameEntity>;
  resolveConflicts?(localGame: GameEntity, cloudGame: GameEntity): Promise<GameEntity>;
}

// infrastructure/repositories/GameRepository.ts
export class GameRepository implements IGameRepository {
  constructor(
    private localStorage: SQLiteStorage,
    private cloudApi?: CloudGameApi // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ
  ) {}

  async save(game: GameEntity): Promise<void> {
    // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    await this.localStorage.save(game);

    // –ï—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    if (this.cloudApi && await this.cloudApi.isAuthenticated()) {
      try {
        await this.cloudApi.uploadGame(game);
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏, –∏–≥—Ä–∞ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ
        console.warn('Failed to sync game to cloud:', error);
      }
    }
  }
}
```

### 2. Service Layer –¥–ª—è API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```typescript
// application/services/SyncService.ts
export interface ISyncService {
  isOnline(): boolean;
  isAuthenticated(): boolean;
  syncUserData(): Promise<SyncResult>;
  enableOfflineMode(): void;
  enableOnlineMode(): void;
}

export class SyncService implements ISyncService {
  constructor(
    private networkService: INetworkService,
    private authService: IAuthService,
    private gameRepository: IGameRepository,
    private statisticsRepository: IStatisticsRepository
  ) {}

  async syncUserData(): Promise<SyncResult> {
    if (!this.isOnline() || !this.isAuthenticated()) {
      return { success: false, reason: 'offline_or_unauthorized' };
    }

    try {
      // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—ã
      await this.gameRepository.syncWithCloud!(await this.authService.getUserId());

      // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      await this.statisticsRepository.syncWithCloud!(await this.authService.getUserId());

      return { success: true };
    } catch (error) {
      return { success: false, reason: 'sync_failed', error };
    }
  }
}
```

### 3. Network Abstraction Layer

```typescript
// infrastructure/network/NetworkService.ts
export interface INetworkService {
  isConnected(): boolean;
  get<T>(url: string, options?: RequestOptions): Promise<T>;
  post<T>(url: string, data: any, options?: RequestOptions): Promise<T>;
  put<T>(url: string, data: any, options?: RequestOptions): Promise<T>;
  delete<T>(url: string, options?: RequestOptions): Promise<T>;
}

export class NetworkService implements INetworkService {
  private baseURL: string;
  private timeout: number = 10000;

  constructor(config: NetworkConfig) {
    this.baseURL = config.baseURL;
  }

  isConnected(): boolean {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º NetInfo –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    return NetInfo.isConnected.fetch();
  }

  async get<T>(url: string, options: RequestOptions = {}): Promise<T> {
    if (!this.isConnected()) {
      throw new NetworkError('No internet connection');
    }

    const response = await fetch(`${this.baseURL}${url}`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        ...options.headers,
      },
      timeout: this.timeout,
    });

    if (!response.ok) {
      throw new ApiError(response.status, response.statusText);
    }

    return response.json();
  }
}
```

---

## üîÆ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π API Design (–¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)

### 1. Authentication API

```typescript
// –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
POST /api/auth/register
POST /api/auth/login
POST /api/auth/refresh
DELETE /api/auth/logout

// –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/profile
PUT /api/profile
DELETE /api/profile
```

### 2. Games API

```typescript
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏
GET /api/games                    // –°–ø–∏—Å–æ–∫ –∏–≥—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /api/games                   // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
GET /api/games/{id}              // –ü–æ–ª—É—á–∏—Ç—å –∏–≥—Ä—É
PUT /api/games/{id}              // –û–±–Ω–æ–≤–∏—Ç—å –∏–≥—Ä—É
DELETE /api/games/{id}           // –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
POST /api/games/sync             // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–≥—Ä—ã
POST /api/games/{id}/resolve     // –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç
```

### 3. Statistics API

```typescript
// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/statistics              // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET /api/statistics/{difficulty} // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
PUT /api/statistics              // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

// –õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã
GET /api/leaderboards/global     // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
GET /api/leaderboards/friends    // –†–µ–π—Ç–∏–Ω–≥ –¥—Ä—É–∑–µ–π
GET /api/leaderboards/{difficulty} // –ü–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
```

### 4. Social API

```typescript
// –î—Ä—É–∑—å—è
GET /api/friends                 // –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
POST /api/friends/invite         // –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞
POST /api/friends/{id}/accept    // –ü—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
DELETE /api/friends/{id}         // –£–¥–∞–ª–∏—Ç—å –¥—Ä—É–≥–∞

// –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è
GET /api/competitions            // –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è
POST /api/competitions/{id}/join // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
GET /api/competitions/{id}/results // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### 5. Content API

```typescript
// –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã
GET /api/daily-challenges        // –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –≤—ã–∑–æ–≤
POST /api/daily-challenges/complete // –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–∑–æ–≤

// –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–∞–∑–ª—ã
GET /api/puzzles/community       // –ü–∞–∑–ª—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
POST /api/puzzles                // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞–∑–ª
GET /api/puzzles/{id}            // –°–∫–∞—á–∞—Ç—å –ø–∞–∑–ª
```

---

## üì± Offline-First Architecture

### 1. Data Synchronization Strategy

```typescript
// –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
interface SyncStrategy {
  // –ö–æ–Ω—Ñ–ª–∏–∫—Ç-—Ä–µ–∑–æ–ª—é—à–µ–Ω
  conflictResolution: 'last-write-wins' | 'manual' | 'merge';

  // –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
  syncables: {
    games: boolean;
    statistics: boolean;
    settings: boolean;
    achievements: boolean;
  };

  // –ö–æ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
  triggers: {
    onAppStart: boolean;
    onAppResume: boolean;
    onWifiConnect: boolean;
    manual: boolean;
  };
}

// Offline Queue –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
class OfflineQueue {
  private queue: QueueItem[] = [];

  async addToQueue(operation: ApiOperation): Promise<void> {
    this.queue.push({
      id: generateUUID(),
      operation,
      timestamp: Date.now(),
      retryCount: 0,
    });

    await this.persistQueue();

    if (this.networkService.isConnected()) {
      this.processQueue();
    }
  }

  private async processQueue(): Promise<void> {
    while (this.queue.length > 0 && this.networkService.isConnected()) {
      const item = this.queue[0];

      try {
        await this.executeOperation(item.operation);
        this.queue.shift();
      } catch (error) {
        item.retryCount++;

        if (item.retryCount >= MAX_RETRIES) {
          this.queue.shift(); // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        } else {
          break; // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞
        }
      }
    }

    await this.persistQueue();
  }
}
```

### 2. Cache Strategy

```typescript
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –æ—Ç–≤–µ—Ç–æ–≤
class ApiCache {
  private cache = new Map<string, CacheEntry>();

  async get<T>(key: string): Promise<T | null> {
    const entry = this.cache.get(key);

    if (!entry) return null;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞
    if (Date.now() > entry.expiresAt) {
      this.cache.delete(key);
      return null;
    }

    return entry.data;
  }

  async set<T>(key: string, data: T, ttlMs: number = 300000): Promise<void> {
    this.cache.set(key, {
      data,
      expiresAt: Date.now() + ttlMs,
    });
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
export class GameRepository implements IGameRepository {
  async findById(id: string): Promise<GameEntity | null> {
    // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    const localGame = await this.localStorage.findById(id);
    if (localGame) return localGame;

    // –ó–∞—Ç–µ–º –≤ –∫—ç—à–µ API
    const cachedGame = await this.apiCache.get(`game:${id}`);
    if (cachedGame) return cachedGame;

    // –ù–∞–∫–æ–Ω–µ—Ü, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–µ–Ω)
    if (this.cloudApi && this.networkService.isConnected()) {
      try {
        const cloudGame = await this.cloudApi.getGame(id);
        await this.apiCache.set(`game:${id}`, cloudGame);
        return cloudGame;
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ API
      }
    }

    return null;
  }
}
```

---

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –¥–ª—è API (–±—É–¥—É—â–µ–µ)

### 1. Frontend (React Native)

```typescript
// API –∫–ª–∏–µ–Ω—Ç
const apiClient = {
  baseURL: process.env.API_BASE_URL,
  timeout: 10000,

  // Interceptors
  request: [
    authInterceptor,        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
    retryInterceptor,       // –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
    offlineInterceptor,     // –û–±—Ä–∞–±–æ—Ç–∫–∞ offline
  ],

  response: [
    errorInterceptor,       // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    cacheInterceptor,       // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  ]
};

// State management –¥–ª—è API
const apiSlice = createSlice({
  name: 'api',
  initialState: {
    isOnline: false,
    isAuthenticated: false,
    syncStatus: 'idle',
    lastSyncTime: null,
  },
  reducers: {
    setOnlineStatus: (state, action) => {
      state.isOnline = action.payload;
    },
    setSyncStatus: (state, action) => {
      state.syncStatus = action.payload;
    },
  },
});
```

### 2. Backend (–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫)

```yaml
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π backend —Å—Ç–µ–∫
Platform: Node.js + TypeScript
Framework: Express.js –∏–ª–∏ Fastify
Database: PostgreSQL + Redis
Authentication: JWT + Refresh Tokens
File Storage: AWS S3 –∏–ª–∏ Google Cloud Storage
Push Notifications: Firebase FCM
Monitoring: DataDog –∏–ª–∏ New Relic
Deployment: Docker + Kubernetes
CI/CD: GitHub Actions
```

### 3. API Documentation

```yaml
# OpenAPI 3.0 Specification
openapi: 3.0.0
info:
  title: Sudoku Game API
  version: 1.0.0
  description: API for cross-platform Sudoku game

servers:
  - url: https://api.sudoku-game.com/v1
    description: Production server
  - url: https://staging-api.sudoku-game.com/v1
    description: Staging server

security:
  - bearerAuth: []

paths:
  /auth/login:
    post:
      summary: Authenticate user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API

### 1. Performance Metrics

```typescript
// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API
interface ApiMetrics {
  // Response time
  averageResponseTime: number;
  p95ResponseTime: number;
  p99ResponseTime: number;

  // Reliability
  successRate: number;
  errorRate: number;
  timeoutRate: number;

  // Usage
  requestsPerSecond: number;
  activeConnections: number;
  dailyActiveUsers: number;
}

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API –≤—ã–∑–æ–≤–æ–≤
class ApiLogger {
  logRequest(request: ApiRequest): void {
    analytics.track('api_request', {
      endpoint: request.url,
      method: request.method,
      userId: request.userId,
      timestamp: Date.now(),
    });
  }

  logResponse(response: ApiResponse, duration: number): void {
    analytics.track('api_response', {
      statusCode: response.status,
      duration,
      endpoint: response.request.url,
      success: response.status < 400,
    });
  }
}
```

### 2. Error Handling

```typescript
// –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
export class ApiErrorHandler {
  handle(error: ApiError): UserFriendlyError {
    switch (error.code) {
      case 'NETWORK_ERROR':
        return new UserFriendlyError(
          '–ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º',
          '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞',
          'retry'
        );

      case 'AUTHENTICATION_FAILED':
        return new UserFriendlyError(
          '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏',
          '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç –∑–∞–Ω–æ–≤–æ',
          'login'
        );

      case 'SERVER_ERROR':
        return new UserFriendlyError(
          '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
          '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É',
          'contact'
        );

      default:
        return new UserFriendlyError(
          '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',
          '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫',
          'retry'
        );
    }
  }
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API

### 1. Authentication & Authorization

```typescript
// JWT —Ç–æ–∫–µ–Ω—ã —Å Refresh Token —Ä–æ—Ç–∞—Ü–∏–µ–π
interface AuthTokens {
  accessToken: string;     // 15 –º–∏–Ω—É—Ç
  refreshToken: string;    // 30 –¥–Ω–µ–π
  expiresAt: number;
}

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
class SecureTokenStorage {
  async saveTokens(tokens: AuthTokens): Promise<void> {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Keychain (iOS) / Keystore (Android)
    await Keychain.setInternetCredentials(
      'sudoku_auth',
      'access_token',
      tokens.accessToken
    );

    await Keychain.setInternetCredentials(
      'sudoku_refresh',
      'refresh_token',
      tokens.refreshToken
    );
  }

  async getAccessToken(): Promise<string | null> {
    try {
      const credentials = await Keychain.getInternetCredentials('sudoku_auth');
      return credentials.password;
    } catch {
      return null;
    }
  }
}
```

### 2. Data Validation

```typescript
// –í–∞–ª–∏–¥–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤
import * as yup from 'yup';

const gameValidationSchema = yup.object({
  id: yup.string().uuid().required(),
  difficulty: yup.string().oneOf(['easy', 'medium', 'hard', 'expert']).required(),
  grid: yup.array().of(
    yup.array().of(yup.number().min(0).max(9)).length(9)
  ).length(9).required(),
  startTime: yup.date().required(),
  isCompleted: yup.boolean().required(),
});

// –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
class DataEncryption {
  async encrypt(data: string): Promise<string> {
    const key = await this.getEncryptionKey();
    return CryptoJS.AES.encrypt(data, key).toString();
  }

  async decrypt(encryptedData: string): Promise<string> {
    const key = await this.getEncryptionKey();
    const bytes = CryptoJS.AES.decrypt(encryptedData, key);
    return bytes.toString(CryptoJS.enc.Utf8);
  }
}
```

---

## üéØ Roadmap –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ API

### Phase 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (MVP - —Å–µ–π—á–∞—Å)
- ‚úÖ Repository pattern —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
- ‚úÖ Service layer –¥–ª—è –±—É–¥—É—â–µ–≥–æ API
- ‚úÖ Offline-first –ø–æ–¥—Ö–æ–¥
- ‚úÖ Error handling —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### Phase 2: –ë–∞–∑–æ–≤—ã–π API (v1.1)
- üîÆ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- üîÆ –û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–≥—Ä
- üîÆ –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### Phase 3: –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (v1.2)
- üîÆ –î—Ä—É–∑—å—è –∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã
- üîÆ –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- üîÆ –¢—É—Ä–Ω–∏—Ä—ã

### Phase 4: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (v2.0)
- üîÆ –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä —Ä–µ–∂–∏–º—ã
- üîÆ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- üîÆ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–∞–∑–ª—ã
- üîÆ –ü—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏

---

## ‚úÖ –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **MVP –ù–ï —Ç—Ä–µ–±—É–µ—Ç API** - —Ñ–æ–∫—É—Å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π offline –∏–≥—Ä–µ
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ API** - Repository pattern –∏ Service layer
3. **Offline-first –ø–æ–¥—Ö–æ–¥** - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
4. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - API –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### üìã –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤–æ–π –∫ API, –∫–æ–≥–¥–∞:**
1. ‚úÖ Repository interfaces –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç sync –º–µ—Ç–æ–¥—ã
2. ‚úÖ Service layer –∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. ‚úÖ Error handling –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
4. ‚úÖ Offline queue —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –±—É–¥—É—â–∏—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
5. ‚úÖ Data validation –≥–æ—Ç–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä–Ω—ã–º –¥–∞–Ω–Ω—ã–º
6. ‚úÖ Security layer –∑–∞–ª–æ–∂–µ–Ω –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

### üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è API —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
1. **2.2.4** - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. **2.2.5** - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **3.1.1** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
4. **3.2.1** - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ